apiVersion: batch/v1
kind: Job
metadata:
  name: db-mc1-recovery-job
spec:
  template:
    metadata:
      name: db-mc1-recovery-job
    spec:
      containers:
        - name: db-mc1-recovery-job
          image: garland/docker-s3cmd
          env:
            - name: aws_key
              valueFrom:
                secretKeyRef:
                  name: aws-credentials
                  key: key
            - name: aws_secret
              valueFrom:
                secretKeyRef:
                  name: aws-credentials
                  key: secret
            - name: SRC_S3
              value: s3://db.more-cars.net/
            - name: cmd
              value: sync-s3-to-local
          volumeMounts:
            - mountPath: /opt/dest
              name: db-mc1-volume
      volumes:
        - name: db-mc1-volume
          persistentVolumeClaim:
            claimName: db-mc1-volume-pvc
      restartPolicy: OnFailure
